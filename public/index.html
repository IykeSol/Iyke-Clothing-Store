<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Shop - Iyke Clothing Store</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f9fafb; }
    
    /* Header */
    .header { background: white; box-shadow: 0 1px 3px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 50; }
    .header-content { max-width: 1280px; margin: 0 auto; padding: 1rem 1.5rem; display: flex; align-items: center; justify-content: space-between; }
    .logo { font-size: 1.5rem; font-weight: bold; background: linear-gradient(135deg, #3b82f6 0%, #06b6d4 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-decoration: none; }
    .header-icons { display: flex; gap: 1rem; align-items: center; position: relative; }
    .icon-btn { padding: 0.5rem; cursor: pointer; position: relative; background: none; border: none; }
    .icon-btn svg { width: 24px; height: 24px; color: #374151; }
    .icon-btn:hover svg { color: #3b82f6; }
    .cart-badge { position: absolute; top: 0; right: 0; background: #ef4444; color: white; font-size: 0.75rem; border-radius: 9999px; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-weight: bold; }
    
    /* User Menu */
    .user-menu { position: relative; }
    .user-menu-btn { display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 0.75rem; border-radius: 8px; background: #f3f4f6; cursor: pointer; border: none; }
    .user-menu-btn:hover { background: #e5e7eb; }
    .user-name { font-size: 0.875rem; font-weight: 500; color: #111827; max-width: 120px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .dropdown { position: absolute; top: 100%; right: 0; margin-top: 0.5rem; background: white; border-radius: 8px; box-shadow: 0 10px 25px rgba(0,0,0,0.15); min-width: 180px; display: none; z-index: 100; }
    .dropdown.show { display: block; }
    .dropdown a { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; color: #374151; text-decoration: none; transition: all 0.2s; }
    .dropdown a:hover { background: #f3f4f6; color: #3b82f6; }
    .dropdown a svg { width: 18px; height: 18px; }
    .dropdown-divider { height: 1px; background: #e5e7eb; margin: 0.5rem 0; }
    .logout-btn { color: #ef4444 !important; }
    
    /* Logout Icon */
    #logout-icon svg { color: #ef4444; }
    #logout-icon:hover svg { color: #dc2626; }
    
    /* WhatsApp Floating Button */
    .whatsapp-float { position: fixed; bottom: 20px; right: 20px; background: #25D366; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(37, 211, 102, 0.4); cursor: pointer; z-index: 100; transition: all 0.3s; text-decoration: none; }
    .whatsapp-float:hover { transform: scale(1.1); box-shadow: 0 6px 20px rgba(37, 211, 102, 0.6); }
    .whatsapp-float svg { width: 35px; height: 35px; color: white; }
    
    /* Hero */
    .hero { background: linear-gradient(135deg, #3b82f6 0%, #06b6d4 100%); color: white; padding: 3rem 1.5rem; }
    .hero-content { max-width: 1280px; margin: 0 auto; }
    .hero h2 { font-size: 2.5rem; margin-bottom: 0.5rem; }
    .hero p { font-size: 1.125rem; opacity: 0.9; }
    
    /* Products Grid */
    .container { max-width: 1280px; margin: 0 auto; padding: 2rem 1.5rem; }
    .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5rem; }
    
    /* Product Card */
    .product-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1); transition: all 0.3s; }
    .product-card:hover { box-shadow: 0 10px 25px rgba(0,0,0,0.15); transform: translateY(-4px); }
    .product-image { width: 100%; aspect-ratio: 1; background: #e5e7eb; object-fit: cover; }
    .product-info { padding: 1rem; }
    .product-name { font-weight: 600; font-size: 1rem; margin-bottom: 0.5rem; color: #111827; }
    .product-description { font-size: 0.875rem; color: #6b7280; margin-bottom: 0.75rem; line-height: 1.5; display: -webkit-box; -webkit-line-clamp: 2; line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    .product-price { font-size: 1.5rem; font-weight: bold; color: #3b82f6; margin-bottom: 1rem; }
    .product-select { width: 100%; padding: 0.625rem; border: 1px solid #d1d5db; border-radius: 8px; margin-bottom: 0.5rem; font-size: 0.875rem; }
    .product-select:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
    .add-btn { width: 100%; background: linear-gradient(135deg, #3b82f6 0%, #06b6d4 100%); color: white; font-weight: 600; padding: 0.875rem; border: none; border-radius: 8px; cursor: pointer; transition: all 0.2s; }
    .add-btn:hover { transform: scale(1.02); opacity: 0.9; }
    .add-btn.success { background: #10b981; }
    
    /* Empty State */
    .empty-state { text-align: center; padding: 4rem 1rem; display: none; }
    .empty-state.show { display: block; }
    .empty-state svg { width: 100px; height: 100px; margin: 0 auto 1rem; color: #d1d5db; }
    .empty-state h3 { font-size: 1.25rem; color: #374151; margin-bottom: 0.5rem; }
    .empty-state p { color: #6b7280; }
    
    /* Responsive */
    @media (max-width: 640px) {
      .hero h2 { font-size: 1.875rem; }
      .products-grid { grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 1rem; }
      .product-info { padding: 0.75rem; }
      .product-name { font-size: 0.875rem; }
      .product-price { font-size: 1.25rem; }
      .user-name { display: none; }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <a href="/index.html" class="logo">Iyke Store</a>
      <div class="header-icons">
        <!-- Guest View -->
        <div id="guest-menu" style="display: none;">
          <a href="/login.html" class="icon-btn">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
          </a>
        </div>

        <!-- Logged In User Menu -->
        <div id="user-menu" class="user-menu" style="display: none;">
          <button class="user-menu-btn" id="user-menu-button">
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
            <span class="user-name" id="user-name-display">User</span>
            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          
          <div id="user-dropdown" class="dropdown">
            <a href="/orders.html">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
              </svg>
              My Orders
            </a>
            <div class="dropdown-divider"></div>
            <a href="#" id="dropdown-logout-btn" class="logout-btn">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
              </svg>
              Logout
            </a>
          </div>
        </div>

        <!-- Cart Icon -->
        <a href="/cart.html" class="icon-btn">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
          </svg>
          <span id="cart-badge" class="cart-badge" style="display:none;"></span>
        </a>

        <!-- Logout Icon -->
        <button id="logout-icon" class="icon-btn" style="display: none;" title="Logout">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
          </svg>
        </button>
      </div>
    </div>
  </header>

  <!-- Hero -->
  <div class="hero">
    <div class="hero-content">
      <h2>Latest Collection</h2>
      <p>Discover our newest arrivals</p>
    </div>
  </div>

  <!-- Products -->
  <main class="container">
    <div id="products-grid" class="products-grid"></div>
    <div id="empty-state" class="empty-state show">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
      </svg>
      <h3>No products available</h3>
      <p>Check back soon for new items!</p>
    </div>
  </main>

  <!-- WhatsApp Floating Button -->
  <a href="https://wa.me/2348126832604?text=Hi!%20I%20have%20a%20question%20about%20a%20product%20on%20Iyke%20Store." class="whatsapp-float" target="_blank" title="Chat on WhatsApp">
    <svg fill="currentColor" viewBox="0 0 24 24">
      <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
    </svg>
  </a>

  <script>
    const cartKey = 'cart';

    function getCart() {
  try {
    const userId = localStorage.getItem('userId') || 'guest';
    const cartKey = `cart_${userId}`;
    return JSON.parse(localStorage.getItem(cartKey)) || [];
  } catch {
    return [];
  }
}

function saveCart(cart) {
  try {
    const userId = localStorage.getItem('userId') || 'guest';
    const cartKey = `cart_${userId}`;
    localStorage.setItem(cartKey, JSON.stringify(cart));
    updateCartBadge();
  } catch {}
}

    function updateCartBadge() {
      const cart = getCart();
      const count = cart.reduce((sum, item) => sum + item.quantity, 0);
      const badge = document.getElementById('cart-badge');
      if (count > 0) {
        badge.textContent = count;
        badge.style.display = 'flex';
      } else {
        badge.style.display = 'none';
      }
    }

    function checkAuth() {
      const token = localStorage.getItem('accessToken');
      const userName = localStorage.getItem('userName') || 'User';
      
      if (token) {
        document.getElementById('guest-menu').style.display = 'none';
        document.getElementById('user-menu').style.display = 'block';
        document.getElementById('user-name-display').textContent = userName;
        document.getElementById('logout-icon').style.display = 'block';
      } else {
        document.getElementById('guest-menu').style.display = 'block';
        document.getElementById('user-menu').style.display = 'none';
        document.getElementById('logout-icon').style.display = 'none';
      }
    }

    function toggleUserDropdown(e) {
      e.stopPropagation();
      const dropdown = document.getElementById('user-dropdown');
      dropdown.classList.toggle('show');
    }

    function logout() {
  localStorage.removeItem('accessToken');
  localStorage.removeItem('userName');
  localStorage.removeItem('userEmail');
  localStorage.removeItem('userId');
  window.location.href = '/login.html';
}


    function addToCart(product, cardEl) {
      const sizeEl = cardEl.querySelector('.size-select');
      const qtyEl = cardEl.querySelector('.qty-input');
      const btn = cardEl.querySelector('.add-btn');
      
      const size = sizeEl.value;
      const quantity = parseInt(qtyEl.value || '1', 10);
      
      if (!size) {
        alert('Please select a size');
        return;
      }
      
      const cart = getCart();
      const existing = cart.find(
        (item) => item.productId === product._id && item.size === size
      );
      
      if (existing) {
        existing.quantity += quantity;
      } else {
        cart.push({
          productId: product._id,
          name: product.name,
          price: product.price,
          size,
          quantity,
          image: product.images && product.images[0] || '',
        });
      }
      
      saveCart(cart);
      
      btn.textContent = '✓ Added!';
      btn.classList.add('success');
      setTimeout(() => {
        btn.textContent = 'Add to Cart';
        btn.classList.remove('success');
      }, 1500);
    }

    async function fetchProducts() {
      try {
        const res = await fetch('/api/products');
        if (!res.ok) throw new Error('Failed to fetch');
        
        const data = await res.json();
        const grid = document.getElementById('products-grid');
        const emptyState = document.getElementById('empty-state');
        
        if (data.products.length === 0) {
          emptyState.classList.add('show');
          return;
        }
        
        emptyState.classList.remove('show');
        grid.innerHTML = '';
        
        data.products.forEach((p) => {
          const card = document.createElement('div');
          card.className = 'product-card';
          
          const imageUrl = p.images && p.images[0] ? p.images[0] : 'https://via.placeholder.com/400?text=No+Image';
          
          card.innerHTML = `
            <img src="${imageUrl}" alt="${p.name}" class="product-image" />
            <div class="product-info">
              <h3 class="product-name">${p.name}</h3>
              ${p.description ? `<p class="product-description">${p.description}</p>` : ''}
              <p class="product-price">₦${(p.price / 100).toFixed(2)}</p>
              <select class="product-select size-select">
                <option value="">Select Size</option>
                ${p.sizes.map((s) => `<option value="${s}">${s}</option>`).join('')}
              </select>
              <input type="number" min="1" max="${p.stock}" value="1" class="product-select qty-input" placeholder="Qty" />
              <button class="add-btn">Add to Cart</button>
            </div>
          `;
          
          card.querySelector('.add-btn').addEventListener('click', () => addToCart(p, card));
          grid.appendChild(card);
        });
        
      } catch (error) {
        console.error('Error:', error);
      }
    }

    // Event listeners
    document.addEventListener('DOMContentLoaded', function() {
      // Logout icon
      const logoutBtn = document.getElementById('logout-icon');
      if (logoutBtn) {
        logoutBtn.addEventListener('click', function(e) {
          e.preventDefault();
          logout();
        });
      }
      
      // User menu dropdown
      const userMenuBtn = document.getElementById('user-menu-button');
      if (userMenuBtn) {
        userMenuBtn.addEventListener('click', toggleUserDropdown);
      }
      
      // Dropdown logout button
      const dropdownLogout = document.getElementById('dropdown-logout-btn');
      if (dropdownLogout) {
        dropdownLogout.addEventListener('click', function(e) {
          e.preventDefault();
          logout();
        });
      }
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', (e) => {
      const userMenu = document.getElementById('user-menu');
      const dropdown = document.getElementById('user-dropdown');
      if (userMenu && !userMenu.contains(e.target)) {
        dropdown?.classList.remove('show');
      }
    });

    checkAuth();
    fetchProducts();
    updateCartBadge();
  </script>
</body>
</html>
